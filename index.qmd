---
title: "Trabajo Práctico PCA"
authors:
  - name: "Miguel Garrone"
    affiliations: "Universidad Austral"
  - name: "Lucía Tamplin"
  - name: "Milagros Terán"
  - name: "Martín Ceriotti"

format:
  html:
    toc: TRUE
    lang: es

editor: visual
---

## **Introducción**

Trabajo práctico grupal para la materia "Introducción a Data Mining": Análisis de Componentes Principales (PCA)

## **Descripción del dataset.**

Los datos del archivo "quinoa.txt" corresponden a 24 accesiones de quinoa nativa del Noroeste Argentino caracterizadas a través de 10 variables cuantitativas y 8 variables cualitativas.

### Variables cuantitativas

1.  **DIAMTAL**: Diámetro del tallo (mm)

2.  **ALTPL**: Altura de la planta (cm)

3.  **LONGHO**: Longitud de la hoja (mm)

4.  **ANCHOHO**: Ancho de la hoja (mm)

5.  **LONGPEC**: Longitud del peciolo (mm)

6.  **LONGPAN**: Longitud de la panoja (cm)

7.  **LONGGLO**: Longitud del glomérulo (mm)

8.  **DSBF**: Días desde la siembra hasta el botón floral (días)

9.  **DSFL**: Días desde la siembra hasta la floración (días)

10. **DSMF**: Días desde la siembra hasta la madurez fisiológica (días)

### Variables cualitativas

1.  **AX**: Presencia de axilas (Si – No)

2.  **CEstrias**: Color de las estrías (Amarillas – Rojas – Púrpuras – No (no tiene estrías))

3.  **CTallo**: Color del tallo (Rojo – Púrpura – Verde)

4.  **PoRAMA**: Presencia de ramas (Si – No)

5.  **CFA**: Color de la panoja a fin de antesis (Blanca – Púrpura – Gris)

6.  **Cco**: Color de la panoja a la cosecha (Amarilla – Blanca – Púrpura – Marrón)

7.  **TP**: Tipo de panoja (Diferenciada y terminal – No diferenciada)

8.  **FP**: Forma de la panoja (Glomerulada – Amarantiforme)

### Zona

Se decidió agregar una columna a la base de datos llamada "zona", para determinar en qué zona se desarrolla cada una de las plantas. Los datos fueron obtenidos de la columna "poblaciones".

-   Altiplano (AL)

-   Valles de Altura (VA)

-   Valles Húmedos (VH)

-   Valles secos (VS)

```{r}
#| message: false
#| warning: false
#| include: false
#| paged-print: false
knitr::opts_chunk$set(echo = TRUE)

masterPath <- "./PCA datos/"

listofpackages <- c( "psych",     "ggplot2",    "knitr",
                     "pastecs",   "FactoMineR", "grid",
                     "gridExtra", "ggfortify",  "factoextra",
                     "corrplot",  "dplyr", "ggbiplot", "ggrepel")
newPackages <- listofpackages[ !(listofpackages %in% installed.packages()[, "Package"])]
if(length(newPackages)) install.packages(newPackages)
for (paquete in listofpackages) {
  suppressMessages(library(paquete, character.only = TRUE))
}

datos <- read.table(paste0(masterPath,"quinoa.txt"),
                    sep="\t",
                    dec=",",
                    fileEncoding = "utf8",
                    header = T)

datos2 <- read.table(paste0(masterPath,"quinoa.txt"),
                    sep="\t",
                    dec=",",
                    fileEncoding = "utf8",
                    header = T)

datos2 <- mutate(datos2, zona = substr(poblaciones,1,2))
knitr::kable(head(datos))
str(datos)

datos <- select(datos, DIAMTAL,   
                ALTPL ,    
                LONGHO,    
                ANCHOHO,   
                LONGPEC ,  
                LONGPAN ,  
                LONGGLO ,  
                DSBF,      
                DSFL,      
                DSMF      )
res<-pastecs::stat.desc(datos) %>% as.matrix %>% as.data.frame %>% round(2)

res = format(res, scientific = FALSE)

```

## **Análisis Descriptivo**

### Tabla descriptiva sobre las variables numéricas

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
knitr::kable(data.frame(res),digits = 2)
```

### Correlación entre variables, distribuciones y gráficos de dispersión

#### En el gráfico que se presenta a continuación, se puede ver la distribución de cada una de las variables y la correlación que hay entre ellas.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
pairs.panels(datos, 
             method = "pearson", # correlation method
             hist.col = "#00AFBB",
             density = TRUE,  # show density plots
             ellipses = F # show correlation ellipses
)
```

En el gráfico se pueden ver correlaciones altas entre algunas variables y distribuciones poco campanulares.

### Boxplots comparativos entre las variables del conjunto de datos

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
dfInd<-stack(datos)
names(dfInd)<-c("Valor","Variable")
ggplot(dfInd, aes(x = Variable, y = Valor)) +
  geom_boxplot()+  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```

En el gráfico se pueden observar distribuciones muy distintas entre las variables. Además, es posible identificar que están en escalas de medida distintas.

## **Análisis de Componentes Principales (PCA)**

### Proporción de varianza explicada por cada Componente Principal

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
mediPca <- prcomp(as.matrix(datos),center = T, scale. = T)

library(knitr)
library(kableExtra)

# Extraer importancia de los PCs
imp <- summary(mediPca)$importance

# Crear tabla con kable
kable(imp, digits = 3, caption = "Proporción de varianza explicada por cada PC") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"), full_width = FALSE) %>%
  row_spec(0, bold = TRUE, background = "#D3D3D3")  # encabezado estilizado


```

Se pueden observar dos autovalores con desvío estándar mayores a 1. Además, se observa que las dos primeras componentes principales explican el 81,3% de la variabilidad total de los datos.

A continuación, se puede observar la misma información obtenida en la tabla anterior, pero de manera gráfica:

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
barplot(mediPca$sdev,
        main = "Desviación estándar de las Componentes Principales",
        ylab = "Desviación estándar",
        xlab = "Componentes Principales",
        ylim = c(0, max(mediPca$sdev) * 1.2),
        col = "steelblue")


```

### Matriz de Cargas

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false

knitr::kable(as.data.frame(unclass(mediPca$rotation)))
```

La PC1 es una ***componentes de tamaño***, dado que todas las variables tienen el mismo signo. Se consideran scores naturales. El resto de las ***componentes son de forma*****.**

### Datos Transformados. Primeros Registros.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
#Datos transformados (primeros registros)

knitr::kable((mediPca$x))
```

### Biplot.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
# biplot 

autoplot(mediPca, 
         data = datos2, 
         colour = 'zona', 
         loadings = TRUE, 
         loadings.label = TRUE, 
         loadings.label.size = 4,
         size = 4)
```

### Gráfico de Variables.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false


mundoPca <- FactoMineR::PCA(X = datos, scale.unit = T,ncp = ncol(datos), graph = T)

```

Cada vector representa una variables original. La dirección y longitud indican la importancia y la correlación de la vaariable con los componentes principales.

El ángulo entre vectores indica correlación entre variables.

### Coordenadas de las variables en los PC.

```{r}

var <- get_pca_var(mundoPca)
knitr::kable(var$coord)

```

### Calidad de la representación de cada variable en cada PC.

```{r}
knitr::kable(head(var$cos2))

```

### Contribución de cada variable a cda PC.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
knitr::kable(var$contrib)


```

### Contribución de las variables.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
fviz_contrib(mundoPca, choice = "var", axes = 1:2)  #Contribucion de las variables.
```

### Contribución de los individuos.

```{r}
#| echo: false
#| message: false
#| warning: false
#| paged-print: false
fviz_contrib(mundoPca, choice = "ind", axes = 1:2)  #Contribucion de los individuos.
```

## **Conclusión.**

![](paints/interprestacion.png){fig-align="center"}

PC1 agrupa variables de longitud, diámetro y tamaño, las cuales están muy correlacionadas entre sí. Valores altos pueden definir tamaños de planta más grandes , mientras que valores pequeños, plantas más chicas.

PC2 puede ayudar a definir otras características de las plantas, como la velocidad de desarrollo con los distintos días desde la siembra.

-   Altiplano (AL): desarrollo más rápido de plantas, con plantas de menor tamaño.

-   Valles de Altura (VA): plantas más pequeñas con desarrollo m

-   Valles Húmedos (VH): Plantas más grandes y desarrolladas, con menor velocidad de desarrollo.

-   Valles secos (VS): Plantas más grandes y desarrolladas.
